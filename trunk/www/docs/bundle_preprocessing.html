<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">










<html>
  <head>
    <title>Jawr - Bundle preprocessing</title>
    <style type="text/css" media="all">
      @import url("../css/maven-base.css");
      @import url("../css/maven-theme.css");
      @import url("../css/site.css");
    </style>
    <link rel="stylesheet" href="../css/print.css" type="text/css" media="print" />
        <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
      </head>
  <body class="composite">
    <!-- TODO: move this into JavaScript to patch the skin
      <div class="xright">  </div>
    -->
    <div id="leftColumn">
      <div id="navcolumn">
             <dl class=navgroup>
        <dt>About</dt>
        <dd><ul>
              
    <li class="none">
              <a href="../servlets/ProjectHome">Home</a>
        </li>
              
    <li class="none">
              <a href="../introduction.html">Introduction</a>
        </li>
              
    <li class="none">
              <a href="../features.html">Features</a>
        </li>
              
    <li class="none">
              <a href="../changes.html">Change history</a>
        </li>
              
    <li class="none">
              <a href="../team.html">The team</a>
        </li>
          </ul></dd>
    </dl>
      <dl class=navgroup>
        <dt>Documentation</dt>
        <dd><ul>
              
    <li class="none">
              <a href="../docs/servlet.html">The Jawr servlet</a>
        </li>
              
    <li class="none">
              <a href="../docs/descriptor_syntax.html">Descriptor syntax</a>
        </li>
              
    <li class="none">
              <a href="../docs/custom_bundles.html">Bundle definition</a>
        </li>
              
    <li class="none">
              <a href="../docs/source_ordering.html">Source order in bundles</a>
        </li>
              
    <li class="none">
              <a href="../docs/postprocessors.html">Postprocessors</a>
        </li>
              
    <li class="none">
              <a href="../docs/generators.html">Generators</a>
        </li>
              
    <li class="none">
              <a href="../docs/license_files.html">Licenses in resources</a>
        </li>
              
    <li class="none">
              <a href="../docs/taglibs.html">JSP Tag library</a>
        </li>
              
    <li class="none">
              <a href="../docs/plain_html.html">Use in HTML pages</a>
        </li>
              
    <li class="none">
              <a href="../docs/modes.html">Debug and production modes</a>
        </li>
              
    <li class="none">
              <a href="../docs/messages_gen.html">i18n message generator</a>
        </li>
              
    <li class="none">
              <a href="../docs/jmx_support_gen.html">JMX Support</a>
        </li>
              
    <li class="none">
              <a href="../docs/bundle_preprocessing_gen.html">Bundle preprocessing</a>
        </li>
              
    <li class="none">
              <a href="../docs/jawr_maven_plugin_gen.html">Jawr Maven plugin</a>
        </li>
              
    <li class="none">
              <a href="../docs/jawr_ant_task_gen.html">Jawr Ant task</a>
        </li>
          </ul></dd>
    </dl>
      <dl class=navgroup>
        <dt>Integration</dt>
        <dd><ul>
              
    <li class="none">
              <a href="../integration/augmenter.html">Add Jawr to your framework</a>
        </li>
              
    <li class="none">
              <a href="../integration/spring.html">Spring MVC</a>
        </li>
              
    <li class="none">
              <a href="../integration/facelets.html">Facelets Tag library</a>
        </li>
              
    <li class="none">
              <a href="../integration/grails.html">Grails plugin</a>
        </li>
              
    <li class="none">
              <a href="../integration/dwr.html">DWR</a>
        </li>
              
    <li class="none">
              <a href="../integration/validator.html">Commons Validator - Struts</a>
        </li>
          </ul></dd>
    </dl>
      <dl class=navgroup>
        <dt>Tutorials</dt>
        <dd><ul>
              
    <li class="none">
              <a href="../tutorials/quickstart.html">Quick start</a>
        </li>
              
    <li class="none">
              <a href="../tutorials/faq_howto.html">FAQ-Howto</a>
        </li>
              
    <li class="none">
              <a href="../tutorials/libraries.html">Using popular libraries</a>
        </li>
          </ul></dd>
    </dl>
      <dl class=navgroup>
        <dt>API and sources</dt>
        <dd><ul>
              
    <li class="none">
              <a href="../nonav/apidocs/index.html">JavaDocs</a>
        </li>
              
    <li class="none">
              <a href="../nonav/xref/index.html">Source XREF</a>
        </li>
          </ul></dd>
    </dl>
      <dl class=navgroup>
        <dt>Project tools</dt>
        <dd><ul>
              
    <li class="none">
              <a href="../servlets/ProjectHome">Project home</a>
        </li>
              
    <li class="none">
              <a href="../servlets/ProjectMemberList">Membership</a>
        </li>
              
    <li class="none">
              <a href="../servlets/ProjectNewsList">Announcements</a>
        </li>
              
    <li class="none">
              <a href="../servlets/ProjectForumView">Discussion forums</a>
        </li>
              
    <li class="none">
              <a href="../servlets/ProjectMailingListList">Mailing lists</a>
        </li>
              
    <li class="none">
              <a href="../servlets/ProjectDocumentList">Documents & files</a>
        </li>
              
    <li class="none">
              <a href="../source/browse/jawr/">Subversion</a>
        </li>
              
    <li class="none">
              <a href="../servlets/ProjectIssues">Issue tracker</a>
        </li>
          </ul></dd>
    </dl>
        </div>
      <script>
        // replace the java.net project tools with the navigation bar from Maven.
        // also get rid of "Get Involved" thingie too, while we are at it
        var pt = document.getElementById("projecttools");
        var nv = document.getElementById("navcolumn");
        
        while(pt.previousSibling!=null)
          pt.parentNode.removeChild(pt.previousSibling);
        
        pt.parentNode.insertBefore(nv,pt);
        pt.parentNode.removeChild(pt);
      </script>
      <script>
        // kill "description" h3 bar
        var ld = document.getElementById("longdescription");
        if(ld!=null) {
          for( n=ld.firstChild; n!=null; n=n.nextSibling ) {
            if(n.nodeType==1 && n.innerHTML=="Description" ) {
              n.parentNode.removeChild(n);
              break;
            }
          }
        }
      </script>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <div class="section"><h2>Bundle preprocessing</h2>
<p>One of the key features of Jawr is its ability to bundle resources. The process of bundling involves the following steps:</p>
<ul><li>Resolve the bundle mapping definition</li>
<li>Aggregate resources</li>
<li>Minify them</li>
<li>Apply custom post processors</li>
<li>Generate GZIP and non GZIP version</li>
</ul>
<p>By default, this process is done at server startup. This bundling process could take some times, when the application contains a large number of bundles.</p>
<p>Since Jawr 3.0, we have added a feature to preprocess the Jawr bundles. The bundle preprocessing is almost the same as the standard processing, except that it could be done during a build.</p>
<p>We have added 2 properties:</p>
<ul><li><b>jawr.use.bundle.mapping</b> : This flag indicates if during the server startup we should use the data of the preprocessed bundles instead of performing the bundling process. The preprocessed bundles will be found in the Jawr working directory. (See below) </li>
<li><b>jawr.working.directory</b> : This property defines where the jawr working directory is. By default, it's jawrTmp in the web application working directory. </li>
</ul>
<div class="section"><h3>Use bundle mapping property</h3>
<p>When the property <b>jawr.use.bundle.mapping</b> is set to true, Jawr will try to use specific files, which are containing all the data about the bundles (Full mapping paths, bundle hash code ...). These files are searched in the working directory (jawrWrkDir/jawr-(js/css/img)-mapping.properties ). If these files are not found, Jawr will create them in the working directory.</p>
<p>So if you have this property set to true, and you start a fresh application with an empty working directory, the first time, Jawr will process the bundle normally and it will create the mapping files. Then the next time, when you restart your application, Jawr will use the mappings files and skip the bundling process, this will make the startup time of the web application faster.</p>
<p>Note: The full image mapping file located at jawrWrkDir/jawr-img-mapping.properties, will be generated from the image resources defined with the <i>jawr.image.resources</i> property and the CSS images used in the CSS bundles. So for an image which is referenced by an image tag, and which is not part of the image mapping, the hashcode will be generated at runtime, and put in cache.</p>
</div>
<div class="section"><h3>Jawr working directory</h3>
<p>We have added the option to define explicitly the location the working directory. By default the working directory is set in <b>webAppWrkDir</b>/jawrTmp/</p>
<p>The user could define the working directory location somewhere else on the file system using a value, which is prefixed by <b>file://</b>. For example: </p>
<div class="source"><pre>        jawr.working.directory=file://D:/temp/jawr/</pre>
</div>
<p>The user could also define the working directory inside the web application itself. In that case, the value should be a relative path from the web application root directory. For example: </p>
<div class="source"><pre>        jawr.working.directory=/jawrContent/</pre>
</div>
<p>But in that case, Jawr will not be able to create the temporary files in the web application. So this means that the user will have to create the temporary files, and put them in the web application.</p>
</div>
<div class="section"><h3>Bundle Processor</h3>
<p>This class is responsible of preprocessing the bundles, creating the Jawr working directory and the CDN directory.</p>
<p>In the working directory, you will have the content of Jawr working directory generated by Jawr.</p>
<p>In the CDN directory, you will have all the data for the CDN. </p>
<p>An Ant task and a maven plugin have been created to make it easy the integration in the build process. For more information about the usage, please check the documentation for <a href="./jawr_maven_plugin.html"> the maven plugin</a> and <a href="./jawr_ant_task.html"> the Ant task</a>. </p>
<p>To implement this feature, we have decided to simulate the server startup.</p>
<p>This means that we are faking the application server startup:</p>
<ul><li>We read the web.xml file</li>
<li>We initialize the servlets</li>
<li>Then we launch the bundling process. </li>
</ul>
<p>The main method of the bundle processor is the <b>process</b> method. This method takes 5 parameters:</p>
<ul><li><b>baseDirPath</b> the web application base directory path</li>
<li><b>tmpDirPath</b> the temporary directory path</li>
<li><b>destDirPath</b> the destination directory path, where the result will be stored</li>
<li><b>servletsToInitialize</b> the list of comma separated names of servlets to initialize</li>
<li><b>generateCdnFiles</b> the flag indicating if we should generate the CDN files or not</li>
</ul>
<div class="section"><h4>Limitations</h4>
<p>As we have seen, the bundle preprocessing has almost the same behaviour as the standard bundle processing. To implement this feature, we have decided to simulate the server startup. By default we will only initialize the Jawr servlets. You could add in the <b>servletsToInitialize</b> the list of servlets to initialize.</p>
<p>As said above, we only fake a server startup, which means that we don't initialize the entire web application context (filters, servlets ...). This could be a problem if you are initializing things, in the standard server startup, which you are used later in Jawr. These elements could be missing. This is why we have added the parameter <b>servletsToInitialize</b> to be able to initialize other servlets, which you could initialize data used later by Jawr.</p>
</div>
</div>
<div class="section"><h3>CDN support</h3>
<p>One of the goals of this feature is to provide a better support for CDN. In the CDN directory, generated by the BundleProcessor, you will find all the bundles which are accessible in production and in debug modes.</p>
<p>To define the URL which will contain the Jawr bundles on the CDN, you must specify the context path, which should be used like below:</p>
<div class="source"><pre>        jawr.url.contextpath.override=http://myCDN.com/myApplication
        jawr.url.contextpath.ssl.override=https://myCDN.com/myApplication</pre>
</div>
<p>It is also possible to use the resources files from the CDN even in debug mode using:</p>
<div class="source"><pre>        jawr.url.contextpath.override.used.in.debug.mode=true</pre>
</div>
<div class="section"><h4>Apache support</h4>
<p>The bundle processor generates also a configuration file, containing the rewrite settings for the httpd.conf file of apache. This file named <b>jawr-apache-httpd.conf</b> is generated in the <b>CDN</b> folder.</p>
</div>
</div>
<div class="section"><h3>Limitations</h3>
<p>As explained above, the bundle preprocessing use the predefined mapping described in the full mapping files. This means that in debug mode, if you update a resource file, which is already part of a bundle, the change will be taken in account.</p>
<p><b>BUT</b> if you add a new resource file to a bundle mapping, this resource file will never been taken in account, unless you clean your working directory and start again your application.</p>
<p>Note also that, you could switch from debug mode to production mode, without launching the bundling process, but you have to keep in mind that the production bundles are the one which have been processed during the bundling phase. This means that if you have modified a resource file, since the latest bundling process, you will have to launch again the bundling process to have this updated resource file in your production bundle. </p>
</div>
</div>

      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">&#169;  
          2009
    
          
  

  
  
  &nbsp;| Last Published: 08/10/2009
  &nbsp;| Version: 3.1
</div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
